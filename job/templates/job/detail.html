{% extends 'base.html' %}

{% load staticfiles %}
{% block import %}
    <link rel="stylesheet" type="text/css" href="{% static 'job/CSS/detail.css' %}" />
    <script type="text/javascript" src="{% static 'job/JavaScript/detail.js' %}" ></script>
{% endblock %}

{% block content %}
<div class=" row">
    <div class="col-md-4">
    {% if job.is_active %}
        Active
    {% else %}
        Finished
   {% endif %}
    </div>
    <div class="col-md-4">
        {{ job.name }}
    </div>
</div>
<div class="row">
    <div class="col-md-12">
    {% for tag in job.tag_set.all %}
        #{{ tag.tag }}
    {% empty %}
        There are no tags
    {% endfor %}
    </div>
</div>
{% if jobuser %}
<div class="row">
    <div class="col-md-12">
        <form action="{% url 'jobuser:post_update' workjob.id %}">
            <input id="post_update" type="submit" value="Post Update" />
        </form>
    </div>
</div>
{% endif %}
<div class="detail_job_information row">
    <div class="col-md-12">
    {% for image in job.imageupload_set.all %}
        {{ image.image }}
    {% endfor %}
    </div>
</div>
<div class="row">
    <div id="job_description" class="col-md-12">
        {{ job.description }}
    </div>
</div>        
<div class="row">
    <div class="col-md-12">
        <h4>Updates</h4>
        <div id="updates_table_div" class="table_div">
            <table id="updates_table" class="table">
                <thead>
                    <tr>
                        <th>User</th>
                        <th>Date</th>
                        <th>Type</th>
                    </tr>
                </thead>
                <tbody>
                {% for update in ordered_updates reversed %}
                    <tr class="update_{{ update.has_active_complaint }}">
                       <td>
                            {% if workjob.worker.is_active %}
                            <a href="{% url 'user:detail' workjob.worker.username %}" >
                                {{ workjob.worker.first_name }}&nbsp;{{ workjob.worker.last_name }}
                            </a>
                            {% else %}
                            <span>[ Deleted User ]</span>
                            {% endif %}
                        </td>
                            <td>{{ update.updated }}</td>
                        <td><a href="{% url 'jobuser:view_update' update.id %}">{{ update.title }}</a></td>
                    </tr>
                {% empty %}
                    <tr><td>No Updates</td></tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
<div class="row">
    {% if jobuser and jobuser.pledge_set.all.exists %}
    <div class="col-md-6">
        <form action="{{ request.get_full_path }}" method="POST">
            {% csrf_token %}
            <input id="pay_money" class="pledge_work_inputs" type="submit" value="Pay" name="pay_money_to_job" />
        </form>
    </div>
    {% else  %}
    <div class="col-md-6">
        <form action="{{ request.get_full_path }}" method="POST">
            {% csrf_token %}
            <input id="pledge_money" class="pledge_work_inputs" type="submit" value="Pledge" name="pledge_money_to_job" />
        </form>
    </div>
    {% endif %}
    {% if workjob and jobuser.work_set.all.exists %}
    <div class="col-md-6">
        <form action="{{ request.get_full_path }}" method="POST">
            {% csrf_token %}
            <input id="finish_job" class="pledge_work_inputs" type="submit" value="Finish" name="finish_job" />
        </form>
    </div>
    {% else %}
    <div class="col-md-6">
        <form action="{{ request.get_full_path }}" method="POST">
            {% csrf_token %}
            <input id="work_on_job" class="pledge_work_inputs" type="submit" value="Work" name="work_on_job" />
        </form>
    </div>
    {% endif %}
</div>
{% endblock %}